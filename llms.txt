# LLM Workflow Contract - autonomous-testing-ui

Last updated: 2026-02-15

This file defines the mandatory workflow for AI agents in this repository.

## Trigger A: User asks to create a new automated test

Execute the full delivery workflow in `## Mandatory Delivery Workflow`.

## Trigger B: Project card enters Ready

If using GitHub Project automation (`BrunoZanotta / project #3`), execute:

1. Pick next eligible card in `Ready` using priority rules:
- work type first: `bugfix` before `newTest`
- then priority label: `P0` before `P1` before `P2`
2. Create branch
3. Move card to `In progress` immediately after branch creation
4. Create tests from card requirements
5. Run validation and governance gate
6. Commit, push, open PR
7. Move card to `In review`

## Mandatory Delivery Workflow (End-to-End)

1. Preflight
- Validate git repository and remote: `git status`, `git remote -v`
- Validate branch base (default `main`)
- Validate required tools: `node`, `npm`, `npx`, `git`, `gh`
- Validate GitHub Project scopes for gh token: `read:project` and `project`

2. Branch Creation + Card Transition
- Ready cards must include one work-type label:
  - `bug` (or `bugfix`) => work type `bugfix`
  - `new test` (or `newtest`/`new-test`/`new_test`) => work type `newTest`
- Create branch using work-type prefix:
  - `bugfix/<slug>`
  - `newTest/<slug>`
- Immediately move project card `Ready -> In progress`

3. Test Planning and Generation
- Use `.github/agents/playwright/qa-planner.agent.md` for scenario design.
- Use `.github/agents/playwright/qa-generator.agent.md` for implementation.
- Keep architecture contract:
  - `fixtures/` setup and injection only
  - `pages/` selectors, actions, assertions, domain data
  - `tests/` orchestration/steps only

4. Healing and Refactoring
- If tests fail, use `.github/agents/playwright/qa-healer.agent.md`
- If structure/maintainability needs improvement, use `.github/agents/playwright/qa-test-refactorer.agent.md`
- Re-run until stable or produce explicit blocker report

5. Test Execution
- Run discovery: `npx playwright test --list --project=chromium`
- Run relevant test scope first (targeted tests)
- Run broader regression/smoke scope when applicable

6. Governance and Security Gate (Mandatory)
- Execute: `./scripts/ci/governance-gate.sh governance-gate-report.md`
- Use `.github/agents/playwright/qa-governance-guardian.agent.md` as policy source
- If report status is FAIL, stop delivery and do not commit

7. Commit
- Use Conventional Commits:
  - `feat(scope): summary`
  - `fix(scope): summary`
  - `refactor(scope): summary`
  - `chore(scope): summary`
  - `test(scope): summary`
- Never commit `.env`, tokens, secrets, private keys

8. Push and PR Creation
- Use `.github/agents/playwright/gitops-pr-orchestrator.agent.md`
- Preferred command:
  - `./scripts/git/create-pr-flow.sh <branch> <commit-message> [base-branch] [pr-title] [pr-body-file]`
- Required outcome:
  - branch pushed to origin
  - PR opened on GitHub (or exact fallback command if `gh` unavailable)

9. Project Card Transition (when card-driven flow is used)
- Fetch prioritized ready item:
  - `./scripts/git/project-ready-item.sh BrunoZanotta 3 BrunoZanotta/autonomous-testing-ui Ready`
- Run full flow:
  - `./scripts/git/project-ready-to-pr.sh BrunoZanotta 3 BrunoZanotta/autonomous-testing-ui main`
- Move item manually when required:
  - `./scripts/git/project-move-item.sh BrunoZanotta 3 <item_id> "In progress"`
  - `./scripts/git/project-move-item.sh BrunoZanotta 3 <item_id> "In review"`

10. Final Response Contract
- Return:
  - card/item processed (if applicable)
  - work type (`bugfix` or `newTest`)
  - priority label (`P0`/`P1`/`P2`/`NONE`)
  - branch name
  - commit SHA
  - PR URL (or fallback command)
  - checks executed
  - governance gate result
  - card transition result (`Ready -> In progress -> In review`)
  - blocking issues (if any)

## Non-Negotiable Rules

- No hardcoded credentials in tracked source files.
- `.env` must remain ignored.
- No fixed sleeps (`waitForTimeout`, manual sleeps, polling hacks).
- No prohibited waits (`networkidle`).
- Do not bypass failed governance checks.
- Do not use destructive git operations unless explicitly requested.
- Do not auto-process `Ready` card without work-type label (`bug` or `new test`).

## Agent Registry

- Planner: `.github/agents/playwright/qa-planner.agent.md`
- Generator: `.github/agents/playwright/qa-generator.agent.md`
- Healer: `.github/agents/playwright/qa-healer.agent.md`
- Refactorer: `.github/agents/playwright/qa-test-refactorer.agent.md`
- Governance: `.github/agents/playwright/qa-governance-guardian.agent.md`
- GitOps/PR: `.github/agents/playwright/gitops-pr-orchestrator.agent.md`
- Project Ready Orchestrator: `.github/agents/playwright/github-project-ready-pr-orchestrator.agent.md`

## CI Alignment

CI workflows:
- `.github/workflows/playwright.yml`
- `.github/workflows/project-ready-scheduler.yml` (cron ticker every 5 minutes, off top-of-hour)
- `.github/workflows/project-ready-orchestrator.yml` (executor for card-driven branch/test/gate/PR flow)

Local policy script:
- `scripts/ci/governance-gate.sh`

Delivery scripts:
- `scripts/git/create-pr-flow.sh`
- `scripts/git/project-ready-item.sh`
- `scripts/git/project-ready-to-pr.sh`
- `scripts/git/project-move-item.sh`

## Scheduler Runtime Config

Cadence:
- `project-ready-scheduler.yml` ticks at minutes `3,8,13,18,23,28,33,38,43,48,53,58` (UTC).

Required:
- Secret `GH_PROJECT_TOKEN` (repo + project scopes)

Recommended:
- Variable `PROJECT_READY_WORK_CMD` (default implementation command)
  - Example: `bash ./scripts/git/project-ready-work.sh`

Project label conventions:
- Work type labels: `bug` or `new test`
- Priority labels: `P0`, `P1`, `P2`
